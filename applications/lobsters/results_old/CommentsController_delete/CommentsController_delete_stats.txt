User.where <User,SELECT>
User.where(:session_token => session[:u].to_s).first <,SELECT>
+FIELD+ User.deleted_at (datetime)
+FIELD+ User.banned_at (datetime)
+FIELD+ User.id (integer)
+FIELD+ User.username (string)
Keystore.transaction <Keystore,TXN>
self.lock <Keystore,TRANSACTION> (c)
self.lock(true).where <Keystore,SELECT> (c)
kv.save! <Keystore,INSERT> (c)
+FIELD+ Keystore.key (string)
self.where <Keystore,SELECT> (c)
+FIELD+ Keystore.value (integer)
traffic_kv.save! <Keystore,INSERT> (c)
date_kv.save! <Keystore,INSERT> (c)
User.where <User,SELECT>
User.where(:rss_token => params[:token].to_s).first <,SELECT>
Comment.where <Comment,SELECT>
Comment.where(:short_id => params[:id]).first <,SELECT>
+FIELD+ User.id (integer)
+FIELD+ Comment.story_id (integer)
+FIELD+ Comment.id (integer)
Vote.where <Vote,SELECT>
Vote.where(:user_id => @user.id,        :story_id => comment.story_id, :comment_id => comment.id).first <,SELECT>
+FIELD+ User.is_moderator (boolean)
+FIELD+ User.id (integer)
+FIELD+ Comment.user_id (integer)
+FIELD+ User.is_moderator (boolean)
+FIELD+ User.id (integer)
+FIELD+ Comment.user_id (integer)
+FIELD+ Comment.id (integer)
+FIELD+ User.id (integer)
m.save <Moderation,INSERT>
+FIELD+ Moderation.moderator_user_id (integer)
+FIELD+ Moderation.story_id (integer)
+FIELD+ Moderation.story_id (integer)
+FIELD+ Story.user_id (integer)
+FIELD+ Moderation.story_id (integer)
+FIELD+ Story.title (string)
+FIELD+ Moderation.story_id (integer)
+FIELD+ Story.short_id (string)
+FIELD+ Story.title (string)
+FIELD+ Moderation.action (text)
+FIELD+ Moderation.reason (text)
+FIELD+ Message.body (text)
+FIELD+ Moderation.reason (text)
+FIELD+ Moderation.comment_id (integer)
+FIELD+ Moderation.comment_id (integer)
+FIELD+ Comment.user_id (integer)
+FIELD+ Moderation.comment_id (integer)
+FIELD+ Moderation.story_id (integer)
+FIELD+ Story.title (string)
+FIELD+ Moderation.comment_id (integer)
+FIELD+ Moderation.story_id (integer)
+FIELD+ Moderation.comment_id (integer)
+FIELD+ Moderation.comment_id (integer)
+FIELD+ Moderation.reason (text)
+FIELD+ Message.body (text)
+FIELD+ Moderation.reason (text)
+FIELD+ Message.body (text)
m.save <Message,INSERT>
+FIELD+ User.id (integer)
self.where <Message,SELECT>
self.received_messages.unread.count <User,SELECT>
Keystore.connection.execute <,INSERT>
Keystore.connection.execute <,INSERT>
kv.save! <Keystore,INSERT>
+FIELD+ Message.deleted_by_author (boolean)
+FIELD+ Message.deleted_by_recipient (boolean)
self.where <Message,SELECT>
+FIELD+ Message.subject (string)
+FIELD+ Message.body (text)
+FIELD+ User.username (string)
+FIELD+ Message.subject (string)
+FIELD+ Message.body (text)
+FIELD+ Message.short_id (string)
+FIELD+ User.username (string)
+FIELD+ User.pushover_user_key (string)
+FIELD+ User.pushover_user_key (string)
self.save <Comment,INSERT>
+FIELD+ Comment.story_id (integer)
+FIELD+ Comment.id (integer)
+FIELD+ Comment.user_id (integer)
Vote.where <Vote,SELECT>
Vote.where(:user_id => user_id, :story_id => story_id,      :comment_id => comment_id).first_or_initialize <,SELECT>
+FIELD+ Vote.vote (integer)
Vote.transaction <Vote,TXN>
+FIELD+ Vote.vote (integer)
+FIELD+ Vote.vote (integer)
v.new_record? <Vote,INSERT> (c)
+FIELD+ Vote.vote (integer)
+FIELD+ Vote.vote (integer)
v.save! <Vote,INSERT> (c)
+FIELD+ Vote.comment_id (integer)
+FIELD+ Vote.comment_id (integer)
Comment.find <Comment,SELECT> (c)
User.update_counters <User,UPDATE> (c)
+FIELD+ Comment.upvotes (integer)
+FIELD+ Comment.downvotes (integer)
+FIELD+ Comment.upvotes (integer)
+FIELD+ Comment.id (integer)
Comment.connection.execute <,UPDATE> (c)
+FIELD+ Comment.story_id (integer)
self.tags.select <Tag,SELECT> (c)
+FIELD+ Story.user_id (integer)
self.comments.where <Comment,SELECT> (c)
self.comments.where("user_id <> ?", self.user_id).select <Story,SELECT> (c)
+FIELD+ Story.upvotes (integer)
+FIELD+ Story.downvotes (integer)
+FIELD+ Story.created_at (datetime)
+FIELD+ Vote.story_id (integer)
Story.find <Story,SELECT> (c)
User.update_counters <User,UPDATE> (c)
+FIELD+ Story.id (integer)
Story.connection.execute <,UPDATE> (c)
+FIELD+ Comment.story_id (integer)
Story.select <Story,SELECT>
+FIELD+ Story.id (integer)
Story.select(:id).where <,SELECT>
+FIELD+ Story.id (integer)
Comment.where <Comment,SELECT>
self.order <Comment,SELECT>
+FIELD+ Comment.id (integer)
+FIELD+ Comment.is_deleted (boolean)
+FIELD+ Comment.is_moderated (boolean)
+FIELD+ User.is_moderator (boolean)
+FIELD+ Comment.user_id (integer)
+FIELD+ User.id (integer)
+FIELD+ Comment.is_moderated (boolean)
comments.count <Comment,SELECT>
+FIELD+ Comment.user_id (integer)
Keystore.transaction <Keystore,TXN>
Keystore.connection.execute <,INSERT> (c)
Keystore.connection.execute <,INSERT> (c)
Keystore.connection.execute <,INSERT> (c)
kv.save! <,INSERT> (c)
self.where <Keystore,SELECT> (c)
self.where(:key => key).first <Keystore,SELECT> (c)
+FIELD+ Comment.parent_comment_id (integer)
+FIELD+ Comment.parent_comment_id (integer)
self.parent_comment.try <Comment,SELECT>
+FIELD+ User.id (integer)
+FIELD+ Comment.user_id (integer)
+FIELD+ User.id (integer)
+FIELD+ User.email_replies (boolean)
+FIELD+ Comment.short_id (string)
+FIELD+ Comment.short_id (string)
+FIELD+ Comment.short_id (string)
+FIELD+ Comment.parent_comment_id (integer)
+FIELD+ Comment.parent_comment_id (integer)
+FIELD+ Comment.short_id (string)
+FIELD+ Comment.comment (text)
comment.new_record? <Comment,INSERT> (v) (c)
+FIELD+ Comment.parent_comment_id (integer)
+FIELD+ Comment.hat_id (integer)
+FIELD+ User.email (string)
+FIELD+ User.pushover_replies (boolean)
+FIELD+ Comment.user_id (integer)
+FIELD+ User.username (string)
+FIELD+ Comment.story_id (integer)
+FIELD+ Story.title (string)
+FIELD+ Comment.comment (text)
+FIELD+ Comment.story_id (integer)
+FIELD+ Comment.short_id (string)
+FIELD+ Comment.short_id (string)
+FIELD+ Comment.user_id (integer)
+FIELD+ User.username (string)
User.where <User,SELECT> (c)
User.where(:username => mention).first <,SELECT> (c)
+FIELD+ User.id (integer)
+FIELD+ Comment.user_id (integer)
+FIELD+ User.id (integer)
+FIELD+ User.email_mentions (boolean)
+FIELD+ User.email (string)
+FIELD+ User.pushover_mentions (boolean)
+FIELD+ Comment.user_id (integer)
+FIELD+ User.username (string)
+FIELD+ Comment.story_id (integer)
+FIELD+ Story.title (string)
+FIELD+ Comment.user_id (integer)
+FIELD+ User.username (string)
+FIELD+ Comment.story_id (integer)
+FIELD+ Comment.short_id (string)
+FIELD+ Comment.short_id (string)
+FIELD+ Comment.upvotes (integer)
+FIELD+ Comment.downvotes (integer)
+FIELD+ User.created_at (datetime)
obj.current_vote.try <,SELECT> (v)
+FIELD+ Comment.short_id (string)
+FIELD+ User.show_avatars (boolean)
+FIELD+ Comment.user_id (integer)
+FIELD+ User.username (string)
+FIELD+ Comment.user_id (integer)
+FIELD+ Comment.user_id (integer)
+FIELD+ User.username (string)
+FIELD+ Comment.user_id (integer)
+FIELD+ Comment.user_id (integer)
+FIELD+ Comment.user_id (integer)
+FIELD+ User.username (string)
+FIELD+ Comment.hat_id (integer)
+FIELD+ Comment.hat_id (integer)
+FIELD+ Hat.link (string)
+FIELD+ Hat.link (string)
+FIELD+ Hat.granted_by_user_id (integer)
+FIELD+ Hat.created_at (datetime)
+FIELD+ Hat.link (string)
+FIELD+ Hat.link (string)
+FIELD+ Hat.link (string)
+FIELD+ Hat.hat (string)
+FIELD+ Comment.updated_at (datetime)
+FIELD+ Comment.updated_at (datetime)
+FIELD+ Comment.created_at (datetime)
+FIELD+ Comment.is_from_email (boolean)
+FIELD+ Comment.updated_at (datetime)
+FIELD+ Comment.created_at (datetime)
+FIELD+ User.id (integer)
+FIELD+ Comment.user_id (integer)
+FIELD+ Comment.is_moderated (boolean)
+FIELD+ Comment.updated_at (datetime)
+FIELD+ Comment.updated_at (datetime)
+FIELD+ Comment.created_at (datetime)
+FIELD+ User.is_moderator (boolean)
+FIELD+ User.id (integer)
+FIELD+ Comment.user_id (integer)
+FIELD+ Comment.is_moderated (boolean)
+FIELD+ Comment.story_id (integer)
+FIELD+ Comment.downvotes (integer)
+FIELD+ Comment.user_id (integer)
@user.try <User,SELECT> (v)
@user.try <User,SELECT> (v)
+FIELD+ Comment.id (integer)
Vote.where <Vote,SELECT> (v)
r_counts.keys.sort.map{|k|      k == "" ? "+#{r_counts[k]}" : "#{r_counts[k]} #{VoteCOMMENT_REASONS[k]}"    }.join <,JOIN> (v)
+FIELD+ Comment.story_id (integer)
+FIELD+ Story.short_id (string)
+FIELD+ Comment.story_id (integer)
+FIELD+ Story.title (string)
+FIELD+ Comment.is_moderated (boolean)
self.moderation.try(:moderator).try <Comment,SELECT> (v)
self.moderation.try(:moderator).try <Comment,SELECT> (v)
self.moderation.try(:moderator).try <Comment,SELECT> (v)
+FIELD+ Comment.markeddown_comment (text)

query in total: 62
query in view: 9
query in closure: 34
read queries: 38
write queries: 20
