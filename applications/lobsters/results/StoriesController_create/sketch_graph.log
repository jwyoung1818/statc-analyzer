digraph sketch {
	n20 [label=<<i>20__ User(User)   where</i>> color=blue]; 
	n20 -> n21 [label="0"]
	n21 [label=<<i>21__ User where( session_token =) session( u) to_s)   first</i>> color=blue]; 
	n109 [label=<<i>109__ self(ApplicationController)   params</i>> color=crimson]; 
	n142 [label=<<i>142__ self lock(true) where( key =) key)   first</i>> color=blue]; 
	n143 [label=<<i>143__ self lock(true)   where</i>> color=blue]; 
	n144 [label=<<i>144__ self(Keystore)   lock</i>> color=blue]; 
	n151 [label=<<i>151__ key   where</i>> color=blue]; 
	n153 [label=<<i>153__ kv(Keystore)   save!</i>> color=blue]; 
	n184 [label=<<i>184__ traffic_kv(Keystore)   value</i>> color=darkorange]; 
	n184 -> n186 [label="0"]
	n186 [label=<<i>186__ traffic_kv(Keystore)   save!</i>> color=blue]; 
	n188 [label=<<i>188__ date_kv(Keystore)   value</i>> color=darkorange]; 
	n188 -> n190 [label="0"]
	n190 [label=<<i>190__ date_kv(Keystore)   save!</i>> color=blue]; 
	n261 [label=<<i>261__ self(StoriesController)   params</i>> color=crimson]; 
	n261 -> n284 [label="6"]
	n261 -> n1662 [label="7"]
	n261 -> n934 [label="10"]
	n261 -> n316 [label="11"]
	n261 -> n1056 [label="11"]
	n261 -> n1060 [label="11"]
	n261 -> n1133 [label="11"]
	n261 -> n1139 [label="11"]
	n261 -> n1487 [label="11"]
	n261 -> n1638 [label="13"]
	n261 -> n519 [label="14"]
	n261 -> n968 [label="14"]
	n261 -> n399 [label="15"]
	n261 -> n374 [label="16"]
	n261 -> n434 [label="16"]
	n261 -> n694 [label="16"]
	n261 -> n696 [label="16"]
	n261 -> n1543 [label="16"]
	n261 -> n604 [label="17"]
	n261 -> n1525 [label="17"]
	n261 -> n543 [label="19"]
	n261 -> n547 [label="19"]
	n261 -> n554 [label="19"]
	n261 -> n564 [label="19"]
	n261 -> n1530 [label="19"]
	n261 -> n568 [label="21"]
	n261 -> n569 [label="21"]
	n261 -> n570 [label="21"]
	n284 [label=<<i>284__ @story(Story)   user_id</i>> color=darkorange]; 
	n316 [label=<<i>316__ user_id   where</i>> color=blue]; 
	n374 [label=<<i>374__ self(Story)   short_id</i>> color=darkorange]; 
	n376 [label=<<i>376__ self(Story)   upvotes</i>> color=darkorange]; 
	n399 [label=<<i>399__ self tags(Tag)   select</i>> color=blue]; 
	n434 [label=<<i>434__ self comments(Comment)   where</i>> color=blue]; 
	n434 -> n435 [label="0"]
	n435 [label=<<i>435__ self comments where("user_id () ?", self user_id)   select</i>> color=blue]; 
	n435 -> n934 [label="17"]
	n519 [label=<<i>519__ self(Story)   hotness</i>> color=darkorange]; 
	n519 -> n934 [label="0"]
	n543 [label=<<i>543__ Keystore connection   execute</i>> color=blue]; 
	n547 [label=<<i>547__ Keystore connection   execute</i>> color=blue]; 
	n554 [label=<<i>554__ Keystore connection   execute</i>> color=blue]; 
	n564 [label=<<i>564__ kv   save!</i>> color=blue]; 
	n568 [label=<<i>568__ self where( key =) key) first   try</i>> color=blue]; 
	n569 [label=<<i>569__ self where( key =) key)   first</i>> color=blue]; 
	n570 [label=<<i>570__ self(Keystore)   where</i>> color=blue]; 
	n604 [label=<<i>604__ Vote(Vote)   where</i>> color=blue]; 
	n604 -> n605 [label="0"]
	n605 [label=<<i>605__ Vote where( user_id =) user_id,  story_id =) story_id,       comment_id =) comment_id)   first_or_initialize</i>> color=blue]; 
	n605 -> n650 [label="1"]
	n605 -> n656 [label="1"]
	n605 -> n698 [label="1"]
	n605 -> n715 [label="2"]
	n605 -> n858 [label="2"]
	n650 [label=<<i>650__ v(Vote)   destroy!</i>> color=blue]; 
	n656 [label=<<i>656__ v(Vote)   new_record?</i>> color=blue]; 
	n694 [label=<<i>694__ v(Vote)   vote</i>> color=darkorange]; 
	n694 -> n698 [label="0"]
	n694 -> n715 [label="1"]
	n694 -> n858 [label="1"]
	n696 [label=<<i>696__ v(Vote)   reason</i>> color=darkorange]; 
	n696 -> n698 [label="0"]
	n696 -> n715 [label="1"]
	n696 -> n858 [label="1"]
	n698 [label=<<i>698__ v(Vote)   save!</i>> color=blue]; 
	n715 [label=<<i>715__ Comment(Comment)   find</i>> color=blue]; 
	n715 -> n726 [label="2"]
	n715 -> n744 [label="5"]
	n715 -> n749 [label="5"]
	n715 -> n837 [label="7"]
	n726 [label=<<i>726__ User(User)   update_counters</i>> color=blue]; 
	n744 [label=<<i>744__ _self(Comment)   upvotes</i>> color=darkorange]; 
	n744 -> n837 [label="4"]
	n749 [label=<<i>749__ _self(Comment)   downvotes</i>> color=darkorange]; 
	n749 -> n837 [label="4"]
	n837 [label=<<i>837__ Comment connection   execute</i>> color=blue]; 
	n858 [label=<<i>858__ Story(Story)   find</i>> color=blue]; 
	n858 -> n869 [label="2"]
	n858 -> n920 [label="6"]
	n869 [label=<<i>869__ User(User)   update_counters</i>> color=blue]; 
	n920 [label=<<i>920__ Story connection   execute</i>> color=blue]; 
	n934 [label=<<i>934__ self(Story)   new_record?</i>> color=blue]; 
	n968 [label=<<i>968__ tg   new_record?</i>> color=blue]; 
	n1056 [label=<<i>1056__ self editor   try</i>> color=blue]; 
	n1056 -> n1057 [label="0"]
	n1057 [label=<<i>1057__ m(Moderation)   moderator_user_id</i>> color=darkorange]; 
	n1057 -> n1449 [label="0"]
	n1057 -> n1448 [label="3"]
	n1057 -> n1299 [label="4"]
	n1057 -> n1301 [label="4"]
	n1057 -> n1662 [label="6"]
	n1057 -> n1316 [label="9"]
	n1057 -> n1274 [label="11"]
	n1057 -> n1273 [label="11"]
	n1060 [label=<<i>1060__ m(Moderation)   story_id</i>> color=darkorange]; 
	n1060 -> n1449 [label="0"]
	n1060 -> n1448 [label="3"]
	n1060 -> n1299 [label="4"]
	n1060 -> n1301 [label="4"]
	n1060 -> n1662 [label="6"]
	n1060 -> n1316 [label="9"]
	n1060 -> n1274 [label="11"]
	n1060 -> n1273 [label="11"]
	n1070 [label=<<i>1070__ m(Moderation)   action</i>> color=darkorange]; 
	n1070 -> n1449 [label="0"]
	n1070 -> n1448 [label="3"]
	n1070 -> n1299 [label="4"]
	n1070 -> n1301 [label="4"]
	n1070 -> n1662 [label="6"]
	n1070 -> n1316 [label="9"]
	n1070 -> n1274 [label="11"]
	n1070 -> n1273 [label="11"]
	n1082 [label=<<i>1082__ m(Moderation)   action</i>> color=darkorange]; 
	n1082 -> n1449 [label="0"]
	n1082 -> n1448 [label="3"]
	n1082 -> n1299 [label="4"]
	n1082 -> n1301 [label="4"]
	n1082 -> n1662 [label="6"]
	n1082 -> n1316 [label="9"]
	n1082 -> n1274 [label="11"]
	n1082 -> n1273 [label="11"]
	n1133 [label=<<i>1133__ all_changes map{|k,v|        if k == "merged_story_id"          if v(1)            "merged into #{self merged_into_story short_id} " ((              "(#{self merged_into_story title})"          else            "unmerged from another story"          end        else          "changed #{k} from #{v(0) inspect} to #{v(1) inspect}"        end      }   join</i>> color=blue]; 
	n1133 -> n1134 [label="0"]
	n1134 [label=<<i>1134__ m(Moderation)   action</i>> color=darkorange]; 
	n1134 -> n1449 [label="0"]
	n1134 -> n1448 [label="3"]
	n1134 -> n1299 [label="4"]
	n1134 -> n1301 [label="4"]
	n1134 -> n1662 [label="6"]
	n1134 -> n1316 [label="9"]
	n1134 -> n1274 [label="11"]
	n1134 -> n1273 [label="11"]
	n1139 [label=<<i>1139__ m(Moderation)   reason</i>> color=darkorange]; 
	n1139 -> n1449 [label="0"]
	n1139 -> n1448 [label="3"]
	n1139 -> n1299 [label="4"]
	n1139 -> n1301 [label="4"]
	n1139 -> n1662 [label="6"]
	n1139 -> n1316 [label="9"]
	n1139 -> n1274 [label="11"]
	n1139 -> n1273 [label="11"]
	n1273 [label=<<i>1273__ self received_messages unread   count</i>> color=blue]; 
	n1273 -> n1274 [label="0"]
	n1274 [label=<<i>1274__ Keystore(Keystore)   put</i>> color=blue]; 
	n1299 [label=<<i>1299__ recipient   where</i>> color=blue]; 
	n1301 [label=<<i>1301__ recipient   where</i>> color=blue]; 
	n1316 [label=<<i>1316__ self(Message)   short_id</i>> color=darkorange]; 
	n1448 [label=<<i>1448__ m(Message)   save</i>> color=blue]; 
	n1449 [label=<<i>1449__ m(Moderation)   save</i>> color=blue]; 
	n1451 [label=<<i>1451__ self(Story)   is_moderated</i>> color=darkorange]; 
	n1451 -> n1662 [label="0"]
	n1487 [label=<<i>1487__ self title to_s split("") map{|chr|      if chr ord == 160        " "      else        chr      end    }   join</i>> color=blue]; 
	n1487 -> n1488 [label="0"]
	n1488 [label=<<i>1488__ self(Story)   title</i>> color=darkorange]; 
	n1488 -> n1662 [label="0"]
	n1522 [label=<<i>1522__ Story(Story)   select</i>> color=blue]; 
	n1522 -> n1525 [label="0"]
	n1525 [label=<<i>1525__ Story select( id)   where</i>> color=blue]; 
	n1525 -> n1530 [label="2"]
	n1530 [label=<<i>1530__ Comment(Comment)   where</i>> color=blue]; 
	n1530 -> n1638 [label="2"]
	n1530 -> n1653 [label="2"]
	n1530 -> n1543 [label="3"]
	n1543 [label=<<i>1543__ self(Comment)   order</i>> color=blue]; 
	n1607 [label=<<i>1607__ node(Comment)   indent_level</i>> color=darkorange]; 
	n1638 [label=<<i>1638__ comments(Comment)   count</i>> color=blue]; 
	n1638 -> n1653 [label="0"]
	n1653 [label=<<i>1653__ self(Story)   comments_count</i>> color=darkorange]; 
	n1662 [label=<<i>1662__ @story(Story)   save</i>> color=blue]; 
}