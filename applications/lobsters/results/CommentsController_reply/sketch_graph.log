digraph sketch {
	n20 [label=<<i>20__ User(User)   where</i>> color=blue]; 
	n20 -> n21 [label="0"]
	n21 [label=<<i>21__ User where( session_token =) session( u) to_s)   first</i>> color=blue]; 
	n109 [label=<<i>109__ self(ApplicationController)   params</i>> color=crimson]; 
	n142 [label=<<i>142__ self lock(true) where( key =) key)   first</i>> color=blue]; 
	n143 [label=<<i>143__ self lock(true)   where</i>> color=blue]; 
	n144 [label=<<i>144__ self(Keystore)   lock</i>> color=blue]; 
	n151 [label=<<i>151__ key   where</i>> color=blue]; 
	n153 [label=<<i>153__ kv(Keystore)   save!</i>> color=blue]; 
	n184 [label=<<i>184__ traffic_kv(Keystore)   value</i>> color=darkorange]; 
	n184 -> n186 [label="0"]
	n186 [label=<<i>186__ traffic_kv(Keystore)   save!</i>> color=blue]; 
	n188 [label=<<i>188__ date_kv(Keystore)   value</i>> color=darkorange]; 
	n188 -> n190 [label="0"]
	n190 [label=<<i>190__ date_kv(Keystore)   save!</i>> color=blue]; 
	n225 [label=<<i>225__ self(CommentsController)   params</i>> color=crimson]; 
	n225 -> n228 [label="2"]
	n228 [label=<<i>228__ Comment(Comment)   where</i>> color=blue]; 
	n228 -> n229 [label="0"]
	n229 [label=<<i>229__ Comment where( short_id =) params( id))   first</i>> color=blue]; 
	n229 -> n243 [label="3"]
	n229 -> n267 [label="4"]
	n243 [label=<<i>243__ Vote(Vote)   where</i>> color=blue]; 
	n243 -> n244 [label="0"]
	n244 [label=<<i>244__ Vote where( user_id =) @user id,         story_id =) comment story_id,  comment_id =) comment id)   first</i>> color=blue]; 
	n244 -> n245 [label="0"]
	n245 [label=<<i>245__ comment(Comment)   current_vote</i>> color=darkorange]; 
	n245 -> n267 [label="3"]
	n267 [label=<<i>267__ comment(Comment)   story</i>> color=darkorange]; 
	n267 -> n1499 [label="4"]
	n267 -> n1188 [label="5"]
	n267 -> n479 [label="7"]
	n267 -> n688 [label="7"]
	n267 -> n690 [label="7"]
	n267 -> n1136 [label="7"]
	n267 -> n1384 [label="7"]
	n267 -> n1395 [label="7"]
	n267 -> n496 [label="8"]
	n267 -> n598 [label="8"]
	n267 -> n409 [label="9"]
	n267 -> n1041 [label="10"]
	n267 -> n1023 [label="11"]
	n267 -> n1028 [label="13"]
	n269 [label=<<i>269__ comment(Comment)   parent_comment</i>> color=darkorange]; 
	n269 -> n1499 [label="4"]
	n269 -> n1188 [label="5"]
	n269 -> n479 [label="7"]
	n269 -> n688 [label="7"]
	n269 -> n690 [label="7"]
	n269 -> n1136 [label="7"]
	n269 -> n1384 [label="7"]
	n269 -> n1395 [label="7"]
	n269 -> n496 [label="8"]
	n269 -> n598 [label="8"]
	n269 -> n409 [label="9"]
	n269 -> n1041 [label="10"]
	n269 -> n1023 [label="11"]
	n269 -> n1028 [label="13"]
	n409 [label=<<i>409__ self(Comment)   short_id</i>> color=darkorange]; 
	n411 [label=<<i>411__ _self(Comment)   upvotes</i>> color=darkorange]; 
	n479 [label=<<i>479__ self(Comment)   confidence</i>> color=darkorange]; 
	n496 [label=<<i>496__ self(Comment)   thread_id</i>> color=darkorange]; 
	n507 [label=<<i>507__ Keystore connection   execute</i>> color=blue]; 
	n511 [label=<<i>511__ Keystore connection   execute</i>> color=blue]; 
	n518 [label=<<i>518__ Keystore connection   execute</i>> color=blue]; 
	n528 [label=<<i>528__ kv   save!</i>> color=blue]; 
	n532 [label=<<i>532__ self where( key =) key) first   try</i>> color=blue]; 
	n533 [label=<<i>533__ self where( key =) key)   first</i>> color=blue]; 
	n534 [label=<<i>534__ self(Keystore)   where</i>> color=blue]; 
	n536 [label=<<i>536__ self(Comment)   thread_id</i>> color=darkorange]; 
	n598 [label=<<i>598__ Vote(Vote)   where</i>> color=blue]; 
	n598 -> n599 [label="0"]
	n599 [label=<<i>599__ Vote where( user_id =) user_id,  story_id =) story_id,       comment_id =) comment_id)   first_or_initialize</i>> color=blue]; 
	n599 -> n644 [label="1"]
	n599 -> n650 [label="1"]
	n599 -> n692 [label="1"]
	n599 -> n709 [label="2"]
	n599 -> n926 [label="2"]
	n644 [label=<<i>644__ v(Vote)   destroy!</i>> color=blue]; 
	n650 [label=<<i>650__ v(Vote)   new_record?</i>> color=blue]; 
	n688 [label=<<i>688__ v(Vote)   vote</i>> color=darkorange]; 
	n688 -> n692 [label="0"]
	n688 -> n709 [label="1"]
	n688 -> n926 [label="1"]
	n690 [label=<<i>690__ v(Vote)   reason</i>> color=darkorange]; 
	n690 -> n692 [label="0"]
	n690 -> n709 [label="1"]
	n690 -> n926 [label="1"]
	n692 [label=<<i>692__ v(Vote)   save!</i>> color=blue]; 
	n709 [label=<<i>709__ Comment(Comment)   find</i>> color=blue]; 
	n709 -> n720 [label="2"]
	n709 -> n737 [label="5"]
	n709 -> n742 [label="5"]
	n709 -> n774 [label="7"]
	n709 -> n797 [label="8"]
	n709 -> n832 [label="9"]
	n720 [label=<<i>720__ User(User)   update_counters</i>> color=blue]; 
	n737 [label=<<i>737__ _self(Comment)   upvotes</i>> color=darkorange]; 
	n737 -> n774 [label="4"]
	n737 -> n797 [label="5"]
	n737 -> n832 [label="6"]
	n742 [label=<<i>742__ _self(Comment)   downvotes</i>> color=darkorange]; 
	n742 -> n774 [label="4"]
	n742 -> n797 [label="5"]
	n742 -> n832 [label="6"]
	n774 [label=<<i>774__ Comment connection   execute</i>> color=blue]; 
	n797 [label=<<i>797__ self tags(Tag)   select</i>> color=blue]; 
	n832 [label=<<i>832__ self comments(Comment)   where</i>> color=blue]; 
	n832 -> n833 [label="0"]
	n833 [label=<<i>833__ self comments where("user_id () ?", self user_id)   select</i>> color=blue]; 
	n926 [label=<<i>926__ Story(Story)   find</i>> color=blue]; 
	n926 -> n937 [label="2"]
	n926 -> n988 [label="6"]
	n937 [label=<<i>937__ User(User)   update_counters</i>> color=blue]; 
	n988 [label=<<i>988__ Story connection   execute</i>> color=blue]; 
	n1020 [label=<<i>1020__ Story(Story)   select</i>> color=blue]; 
	n1020 -> n1023 [label="0"]
	n1023 [label=<<i>1023__ Story select( id)   where</i>> color=blue]; 
	n1023 -> n1028 [label="2"]
	n1028 [label=<<i>1028__ Comment(Comment)   where</i>> color=blue]; 
	n1028 -> n1136 [label="2"]
	n1028 -> n1151 [label="2"]
	n1028 -> n1041 [label="3"]
	n1041 [label=<<i>1041__ self(Comment)   order</i>> color=blue]; 
	n1105 [label=<<i>1105__ node(Comment)   indent_level</i>> color=darkorange]; 
	n1136 [label=<<i>1136__ comments(Comment)   count</i>> color=blue]; 
	n1136 -> n1151 [label="0"]
	n1151 [label=<<i>1151__ self(Story)   comments_count</i>> color=darkorange]; 
	n1188 [label=<<i>1188__ self parent_comment   try</i>> color=blue]; 
	n1384 [label=<<i>1384__ self plaintext_comment scan(/\B\@((\w\-)+)/) flatten   uniq</i>> color=blue]; 
	n1384 -> n1395 [label="3"]
	n1395 [label=<<i>1395__ User(User)   where</i>> color=blue]; 
	n1395 -> n1396 [label="0"]
	n1396 [label=<<i>1396__ User where( username =) mention)   first</i>> color=blue]; 
	n1499 [label=<<i>1499__ comment(Comment)   new_record?</i>> color=blue]; 
}