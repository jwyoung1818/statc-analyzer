digraph sketch {
	n20 [label=<<i>20__ User(User)   where</i>> color=blue]; 
	n20 -> n21 [label="0"]
	n21 [label=<<i>21__ User where( session_token =) session( u) to_s)   first</i>> color=blue]; 
	n109 [label=<<i>109__ self(ApplicationController)   params</i>> color=crimson]; 
	n142 [label=<<i>142__ self lock(true) where( key =) key)   first</i>> color=blue]; 
	n143 [label=<<i>143__ self lock(true)   where</i>> color=blue]; 
	n144 [label=<<i>144__ self(Keystore)   lock</i>> color=blue]; 
	n151 [label=<<i>151__ key   where</i>> color=blue]; 
	n153 [label=<<i>153__ kv(Keystore)   save!</i>> color=blue]; 
	n184 [label=<<i>184__ traffic_kv(Keystore)   value</i>> color=darkorange]; 
	n184 -> n186 [label="0"]
	n186 [label=<<i>186__ traffic_kv(Keystore)   save!</i>> color=blue]; 
	n188 [label=<<i>188__ date_kv(Keystore)   value</i>> color=darkorange]; 
	n188 -> n190 [label="0"]
	n190 [label=<<i>190__ date_kv(Keystore)   save!</i>> color=blue]; 
	n225 [label=<<i>225__ self(CommentsController)   params</i>> color=crimson]; 
	n225 -> n228 [label="2"]
	n228 [label=<<i>228__ Comment(Comment)   where</i>> color=blue]; 
	n228 -> n229 [label="0"]
	n229 [label=<<i>229__ Comment where( short_id =) params( id))   first</i>> color=blue]; 
	n229 -> n243 [label="3"]
	n229 -> n1723 [label="5"]
	n229 -> n332 [label="6"]
	n229 -> n329 [label="6"]
	n229 -> n1895 [label="6"]
	n229 -> n2278 [label="6"]
	n229 -> n2367 [label="6"]
	n229 -> n2375 [label="6"]
	n229 -> n2218 [label="7"]
	n229 -> n1492 [label="9"]
	n229 -> n784 [label="11"]
	n229 -> n993 [label="11"]
	n229 -> n995 [label="11"]
	n229 -> n1440 [label="11"]
	n229 -> n1608 [label="11"]
	n229 -> n1619 [label="11"]
	n229 -> n801 [label="12"]
	n229 -> n903 [label="12"]
	n229 -> n714 [label="13"]
	n229 -> n1345 [label="14"]
	n229 -> n1327 [label="15"]
	n229 -> n1332 [label="17"]
	n243 [label=<<i>243__ Vote(Vote)   where</i>> color=blue]; 
	n243 -> n244 [label="0"]
	n244 [label=<<i>244__ Vote where( user_id =) @user id,         story_id =) comment story_id,  comment_id =) comment id)   first</i>> color=blue]; 
	n244 -> n245 [label="0"]
	n245 [label=<<i>245__ comment(Comment)   current_vote</i>> color=darkorange]; 
	n245 -> n1723 [label="4"]
	n245 -> n332 [label="5"]
	n245 -> n329 [label="5"]
	n245 -> n1895 [label="5"]
	n245 -> n2278 [label="5"]
	n245 -> n2367 [label="5"]
	n245 -> n2375 [label="5"]
	n245 -> n2218 [label="6"]
	n245 -> n1492 [label="8"]
	n245 -> n784 [label="10"]
	n245 -> n993 [label="10"]
	n245 -> n995 [label="10"]
	n245 -> n1440 [label="10"]
	n245 -> n1608 [label="10"]
	n245 -> n1619 [label="10"]
	n245 -> n801 [label="11"]
	n245 -> n903 [label="11"]
	n245 -> n714 [label="12"]
	n245 -> n1345 [label="13"]
	n245 -> n1327 [label="14"]
	n245 -> n1332 [label="16"]
	n310 [label=<<i>310__ Comment(Comment)   record_timestamps</i>> color=darkorange]; 
	n312 [label=<<i>312__ self(Comment)   is_deleted</i>> color=darkorange]; 
	n312 -> n1723 [label="0"]
	n312 -> n329 [label="1"]
	n312 -> n1492 [label="4"]
	n312 -> n784 [label="6"]
	n312 -> n993 [label="6"]
	n312 -> n995 [label="6"]
	n312 -> n1440 [label="6"]
	n312 -> n1608 [label="6"]
	n312 -> n1619 [label="6"]
	n312 -> n1895 [label="6"]
	n312 -> n2278 [label="6"]
	n312 -> n2367 [label="6"]
	n312 -> n2375 [label="6"]
	n312 -> n801 [label="7"]
	n312 -> n903 [label="7"]
	n312 -> n2218 [label="7"]
	n312 -> n714 [label="8"]
	n312 -> n1345 [label="9"]
	n312 -> n1327 [label="10"]
	n312 -> n1332 [label="12"]
	n317 [label=<<i>317__ self(Comment)   is_moderated</i>> color=darkorange]; 
	n317 -> n1723 [label="0"]
	n317 -> n329 [label="1"]
	n317 -> n1492 [label="4"]
	n317 -> n784 [label="6"]
	n317 -> n993 [label="6"]
	n317 -> n995 [label="6"]
	n317 -> n1440 [label="6"]
	n317 -> n1608 [label="6"]
	n317 -> n1619 [label="6"]
	n317 -> n1895 [label="6"]
	n317 -> n2278 [label="6"]
	n317 -> n2367 [label="6"]
	n317 -> n2375 [label="6"]
	n317 -> n801 [label="7"]
	n317 -> n903 [label="7"]
	n317 -> n2218 [label="7"]
	n317 -> n714 [label="8"]
	n317 -> n1345 [label="9"]
	n317 -> n1327 [label="10"]
	n317 -> n1332 [label="12"]
	n329 [label=<<i>329__ m(Moderation)   comment_id</i>> color=darkorange]; 
	n329 -> n691 [label="0"]
	n329 -> n690 [label="3"]
	n329 -> n496 [label="4"]
	n329 -> n498 [label="4"]
	n329 -> n558 [label="9"]
	n329 -> n471 [label="11"]
	n329 -> n470 [label="11"]
	n332 [label=<<i>332__ m(Moderation)   moderator_user_id</i>> color=darkorange]; 
	n332 -> n691 [label="0"]
	n332 -> n690 [label="3"]
	n332 -> n496 [label="4"]
	n332 -> n498 [label="4"]
	n332 -> n558 [label="9"]
	n332 -> n471 [label="11"]
	n332 -> n470 [label="11"]
	n335 [label=<<i>335__ m(Moderation)   action</i>> color=darkorange]; 
	n335 -> n691 [label="0"]
	n335 -> n690 [label="3"]
	n335 -> n496 [label="4"]
	n335 -> n498 [label="4"]
	n335 -> n558 [label="9"]
	n335 -> n471 [label="11"]
	n335 -> n470 [label="11"]
	n470 [label=<<i>470__ self received_messages unread   count</i>> color=blue]; 
	n470 -> n471 [label="0"]
	n471 [label=<<i>471__ Keystore(Keystore)   put</i>> color=blue]; 
	n496 [label=<<i>496__ recipient   where</i>> color=blue]; 
	n498 [label=<<i>498__ recipient   where</i>> color=blue]; 
	n558 [label=<<i>558__ self(Message)   short_id</i>> color=darkorange]; 
	n690 [label=<<i>690__ m(Message)   save</i>> color=blue]; 
	n691 [label=<<i>691__ m(Moderation)   save</i>> color=blue]; 
	n714 [label=<<i>714__ self(Comment)   short_id</i>> color=darkorange]; 
	n716 [label=<<i>716__ _self(Comment)   upvotes</i>> color=darkorange]; 
	n784 [label=<<i>784__ self(Comment)   confidence</i>> color=darkorange]; 
	n801 [label=<<i>801__ self(Comment)   thread_id</i>> color=darkorange]; 
	n812 [label=<<i>812__ Keystore connection   execute</i>> color=blue]; 
	n816 [label=<<i>816__ Keystore connection   execute</i>> color=blue]; 
	n823 [label=<<i>823__ Keystore connection   execute</i>> color=blue]; 
	n833 [label=<<i>833__ kv   save!</i>> color=blue]; 
	n837 [label=<<i>837__ self where( key =) key) first   try</i>> color=blue]; 
	n838 [label=<<i>838__ self where( key =) key)   first</i>> color=blue]; 
	n839 [label=<<i>839__ self(Keystore)   where</i>> color=blue]; 
	n841 [label=<<i>841__ self(Comment)   thread_id</i>> color=darkorange]; 
	n903 [label=<<i>903__ Vote(Vote)   where</i>> color=blue]; 
	n903 -> n904 [label="0"]
	n904 [label=<<i>904__ Vote where( user_id =) user_id,  story_id =) story_id,       comment_id =) comment_id)   first_or_initialize</i>> color=blue]; 
	n904 -> n949 [label="1"]
	n904 -> n955 [label="1"]
	n904 -> n997 [label="1"]
	n904 -> n1014 [label="2"]
	n904 -> n1230 [label="2"]
	n949 [label=<<i>949__ v(Vote)   destroy!</i>> color=blue]; 
	n955 [label=<<i>955__ v(Vote)   new_record?</i>> color=blue]; 
	n993 [label=<<i>993__ v(Vote)   vote</i>> color=darkorange]; 
	n993 -> n997 [label="0"]
	n993 -> n1014 [label="1"]
	n993 -> n1230 [label="1"]
	n995 [label=<<i>995__ v(Vote)   reason</i>> color=darkorange]; 
	n995 -> n997 [label="0"]
	n995 -> n1014 [label="1"]
	n995 -> n1230 [label="1"]
	n997 [label=<<i>997__ v(Vote)   save!</i>> color=blue]; 
	n1014 [label=<<i>1014__ Comment(Comment)   find</i>> color=blue]; 
	n1014 -> n1025 [label="2"]
	n1014 -> n1042 [label="5"]
	n1014 -> n1047 [label="5"]
	n1014 -> n1079 [label="7"]
	n1014 -> n1101 [label="8"]
	n1014 -> n1136 [label="9"]
	n1025 [label=<<i>1025__ User(User)   update_counters</i>> color=blue]; 
	n1042 [label=<<i>1042__ _self(Comment)   upvotes</i>> color=darkorange]; 
	n1042 -> n1079 [label="4"]
	n1042 -> n1101 [label="5"]
	n1042 -> n1136 [label="6"]
	n1047 [label=<<i>1047__ _self(Comment)   downvotes</i>> color=darkorange]; 
	n1047 -> n1079 [label="4"]
	n1047 -> n1101 [label="5"]
	n1047 -> n1136 [label="6"]
	n1079 [label=<<i>1079__ Comment connection   execute</i>> color=blue]; 
	n1101 [label=<<i>1101__ self tags(Tag)   select</i>> color=blue]; 
	n1136 [label=<<i>1136__ self comments(Comment)   where</i>> color=blue]; 
	n1136 -> n1137 [label="0"]
	n1137 [label=<<i>1137__ self comments where("user_id () ?", self user_id)   select</i>> color=blue]; 
	n1230 [label=<<i>1230__ Story(Story)   find</i>> color=blue]; 
	n1230 -> n1241 [label="2"]
	n1230 -> n1292 [label="6"]
	n1241 [label=<<i>1241__ User(User)   update_counters</i>> color=blue]; 
	n1292 [label=<<i>1292__ Story connection   execute</i>> color=blue]; 
	n1324 [label=<<i>1324__ Story(Story)   select</i>> color=blue]; 
	n1324 -> n1327 [label="0"]
	n1327 [label=<<i>1327__ Story select( id)   where</i>> color=blue]; 
	n1327 -> n1332 [label="2"]
	n1332 [label=<<i>1332__ Comment(Comment)   where</i>> color=blue]; 
	n1332 -> n1440 [label="2"]
	n1332 -> n1455 [label="2"]
	n1332 -> n1345 [label="3"]
	n1345 [label=<<i>1345__ self(Comment)   order</i>> color=blue]; 
	n1409 [label=<<i>1409__ node(Comment)   indent_level</i>> color=darkorange]; 
	n1440 [label=<<i>1440__ comments(Comment)   count</i>> color=blue]; 
	n1440 -> n1455 [label="0"]
	n1455 [label=<<i>1455__ self(Story)   comments_count</i>> color=darkorange]; 
	n1492 [label=<<i>1492__ self parent_comment   try</i>> color=blue]; 
	n1608 [label=<<i>1608__ self plaintext_comment scan(/\B\@((\w\-)+)/) flatten   uniq</i>> color=blue]; 
	n1608 -> n1619 [label="3"]
	n1619 [label=<<i>1619__ User(User)   where</i>> color=blue]; 
	n1619 -> n1620 [label="0"]
	n1620 [label=<<i>1620__ User where( username =) mention)   first</i>> color=blue]; 
	n1723 [label=<<i>1723__ self(Comment)   save</i>> color=blue]; 
	n1723 -> n1895 [label="6"]
	n1723 -> n2278 [label="6"]
	n1723 -> n2367 [label="6"]
	n1723 -> n2375 [label="6"]
	n1723 -> n2218 [label="7"]
	n1726 [label=<<i>1726__ Comment(Comment)   record_timestamps</i>> color=darkorange]; 
	n1895 [label=<<i>1895__ obj current_vote   try</i>> color=blue]; 
	n2218 [label=<<i>2218__ Vote(Vote)   where</i>> color=blue]; 
	n2278 [label=<<i>2278__ r_counts keys sort map{|k|      k == "" ? "+#{r_counts(k)}"   "#{r_counts(k)} #{VoteCOMMENT_REASONS(k)}"    }   join</i>> color=blue]; 
	n2367 [label=<<i>2367__ self moderation try( moderator)   try</i>> color=blue]; 
	n2367 -> n2368 [label="0"]
	n2368 [label=<<i>2368__ self moderation try( moderator)   try</i>> color=blue]; 
	n2375 [label=<<i>2375__ self moderation try( moderator)   try</i>> color=blue]; 
}