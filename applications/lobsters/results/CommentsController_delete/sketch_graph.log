digraph sketch {
	n20 [label=<<i>20__ User(User)   where</i>> color=blue]; 
	n20 -> n21 [label="0"]
	n21 [label=<<i>21__ User where( session_token =) session( u) to_s)   first</i>> color=blue]; 
	n109 [label=<<i>109__ self(ApplicationController)   params</i>> color=crimson]; 
	n142 [label=<<i>142__ self lock(true) where( key =) key)   first</i>> color=blue]; 
	n143 [label=<<i>143__ self lock(true)   where</i>> color=blue]; 
	n144 [label=<<i>144__ self(Keystore)   lock</i>> color=blue]; 
	n151 [label=<<i>151__ key   where</i>> color=blue]; 
	n153 [label=<<i>153__ kv(Keystore)   save!</i>> color=blue]; 
	n184 [label=<<i>184__ traffic_kv(Keystore)   value</i>> color=darkorange]; 
	n184 -> n186 [label="0"]
	n186 [label=<<i>186__ traffic_kv(Keystore)   save!</i>> color=blue]; 
	n188 [label=<<i>188__ date_kv(Keystore)   value</i>> color=darkorange]; 
	n188 -> n190 [label="0"]
	n190 [label=<<i>190__ date_kv(Keystore)   save!</i>> color=blue]; 
	n225 [label=<<i>225__ self(CommentsController)   params</i>> color=crimson]; 
	n225 -> n228 [label="2"]
	n228 [label=<<i>228__ Comment(Comment)   where</i>> color=blue]; 
	n228 -> n229 [label="0"]
	n229 [label=<<i>229__ Comment where( short_id =) params( id))   first</i>> color=blue]; 
	n229 -> n243 [label="3"]
	n229 -> n1717 [label="5"]
	n229 -> n328 [label="6"]
	n229 -> n325 [label="6"]
	n229 -> n1889 [label="6"]
	n229 -> n2276 [label="6"]
	n229 -> n2365 [label="6"]
	n229 -> n2373 [label="6"]
	n229 -> n2216 [label="7"]
	n229 -> n1486 [label="9"]
	n229 -> n778 [label="11"]
	n229 -> n987 [label="11"]
	n229 -> n989 [label="11"]
	n229 -> n1434 [label="11"]
	n229 -> n1602 [label="11"]
	n229 -> n1613 [label="11"]
	n229 -> n795 [label="12"]
	n229 -> n897 [label="12"]
	n229 -> n708 [label="13"]
	n229 -> n1339 [label="14"]
	n229 -> n1321 [label="15"]
	n229 -> n1326 [label="17"]
	n243 [label=<<i>243__ Vote(Vote)   where</i>> color=blue]; 
	n243 -> n244 [label="0"]
	n244 [label=<<i>244__ Vote where( user_id =) @user id,         story_id =) comment story_id,  comment_id =) comment id)   first</i>> color=blue]; 
	n244 -> n245 [label="0"]
	n245 [label=<<i>245__ comment(Comment)   current_vote</i>> color=darkorange]; 
	n245 -> n1717 [label="4"]
	n245 -> n328 [label="5"]
	n245 -> n325 [label="5"]
	n245 -> n1889 [label="5"]
	n245 -> n2276 [label="5"]
	n245 -> n2365 [label="5"]
	n245 -> n2373 [label="5"]
	n245 -> n2216 [label="6"]
	n245 -> n1486 [label="8"]
	n245 -> n778 [label="10"]
	n245 -> n987 [label="10"]
	n245 -> n989 [label="10"]
	n245 -> n1434 [label="10"]
	n245 -> n1602 [label="10"]
	n245 -> n1613 [label="10"]
	n245 -> n795 [label="11"]
	n245 -> n897 [label="11"]
	n245 -> n708 [label="12"]
	n245 -> n1339 [label="13"]
	n245 -> n1321 [label="14"]
	n245 -> n1326 [label="16"]
	n306 [label=<<i>306__ Comment(Comment)   record_timestamps</i>> color=darkorange]; 
	n308 [label=<<i>308__ self(Comment)   is_deleted</i>> color=darkorange]; 
	n308 -> n1717 [label="0"]
	n308 -> n325 [label="1"]
	n308 -> n1486 [label="4"]
	n308 -> n778 [label="6"]
	n308 -> n987 [label="6"]
	n308 -> n989 [label="6"]
	n308 -> n1434 [label="6"]
	n308 -> n1602 [label="6"]
	n308 -> n1613 [label="6"]
	n308 -> n1889 [label="6"]
	n308 -> n2276 [label="6"]
	n308 -> n2365 [label="6"]
	n308 -> n2373 [label="6"]
	n308 -> n795 [label="7"]
	n308 -> n897 [label="7"]
	n308 -> n2216 [label="7"]
	n308 -> n708 [label="8"]
	n308 -> n1339 [label="9"]
	n308 -> n1321 [label="10"]
	n308 -> n1326 [label="12"]
	n318 [label=<<i>318__ self(Comment)   is_moderated</i>> color=darkorange]; 
	n318 -> n1717 [label="0"]
	n318 -> n325 [label="1"]
	n318 -> n1486 [label="4"]
	n318 -> n778 [label="6"]
	n318 -> n987 [label="6"]
	n318 -> n989 [label="6"]
	n318 -> n1434 [label="6"]
	n318 -> n1602 [label="6"]
	n318 -> n1613 [label="6"]
	n318 -> n1889 [label="6"]
	n318 -> n2276 [label="6"]
	n318 -> n2365 [label="6"]
	n318 -> n2373 [label="6"]
	n318 -> n795 [label="7"]
	n318 -> n897 [label="7"]
	n318 -> n2216 [label="7"]
	n318 -> n708 [label="8"]
	n318 -> n1339 [label="9"]
	n318 -> n1321 [label="10"]
	n318 -> n1326 [label="12"]
	n325 [label=<<i>325__ m(Moderation)   comment_id</i>> color=darkorange]; 
	n325 -> n687 [label="0"]
	n325 -> n686 [label="3"]
	n325 -> n492 [label="4"]
	n325 -> n494 [label="4"]
	n325 -> n554 [label="9"]
	n325 -> n467 [label="11"]
	n325 -> n466 [label="11"]
	n328 [label=<<i>328__ m(Moderation)   moderator_user_id</i>> color=darkorange]; 
	n328 -> n687 [label="0"]
	n328 -> n686 [label="3"]
	n328 -> n492 [label="4"]
	n328 -> n494 [label="4"]
	n328 -> n554 [label="9"]
	n328 -> n467 [label="11"]
	n328 -> n466 [label="11"]
	n331 [label=<<i>331__ m(Moderation)   action</i>> color=darkorange]; 
	n331 -> n687 [label="0"]
	n331 -> n686 [label="3"]
	n331 -> n492 [label="4"]
	n331 -> n494 [label="4"]
	n331 -> n554 [label="9"]
	n331 -> n467 [label="11"]
	n331 -> n466 [label="11"]
	n466 [label=<<i>466__ self received_messages unread   count</i>> color=blue]; 
	n466 -> n467 [label="0"]
	n467 [label=<<i>467__ Keystore(Keystore)   put</i>> color=blue]; 
	n492 [label=<<i>492__ recipient   where</i>> color=blue]; 
	n494 [label=<<i>494__ recipient   where</i>> color=blue]; 
	n554 [label=<<i>554__ self(Message)   short_id</i>> color=darkorange]; 
	n686 [label=<<i>686__ m(Message)   save</i>> color=blue]; 
	n687 [label=<<i>687__ m(Moderation)   save</i>> color=blue]; 
	n708 [label=<<i>708__ self(Comment)   short_id</i>> color=darkorange]; 
	n710 [label=<<i>710__ _self(Comment)   upvotes</i>> color=darkorange]; 
	n778 [label=<<i>778__ self(Comment)   confidence</i>> color=darkorange]; 
	n795 [label=<<i>795__ self(Comment)   thread_id</i>> color=darkorange]; 
	n806 [label=<<i>806__ Keystore connection   execute</i>> color=blue]; 
	n810 [label=<<i>810__ Keystore connection   execute</i>> color=blue]; 
	n817 [label=<<i>817__ Keystore connection   execute</i>> color=blue]; 
	n827 [label=<<i>827__ kv   save!</i>> color=blue]; 
	n831 [label=<<i>831__ self where( key =) key) first   try</i>> color=blue]; 
	n832 [label=<<i>832__ self where( key =) key)   first</i>> color=blue]; 
	n833 [label=<<i>833__ self(Keystore)   where</i>> color=blue]; 
	n835 [label=<<i>835__ self(Comment)   thread_id</i>> color=darkorange]; 
	n897 [label=<<i>897__ Vote(Vote)   where</i>> color=blue]; 
	n897 -> n898 [label="0"]
	n898 [label=<<i>898__ Vote where( user_id =) user_id,  story_id =) story_id,       comment_id =) comment_id)   first_or_initialize</i>> color=blue]; 
	n898 -> n943 [label="1"]
	n898 -> n949 [label="1"]
	n898 -> n991 [label="1"]
	n898 -> n1008 [label="2"]
	n898 -> n1224 [label="2"]
	n943 [label=<<i>943__ v(Vote)   destroy!</i>> color=blue]; 
	n949 [label=<<i>949__ v(Vote)   new_record?</i>> color=blue]; 
	n987 [label=<<i>987__ v(Vote)   vote</i>> color=darkorange]; 
	n987 -> n991 [label="0"]
	n987 -> n1008 [label="1"]
	n987 -> n1224 [label="1"]
	n989 [label=<<i>989__ v(Vote)   reason</i>> color=darkorange]; 
	n989 -> n991 [label="0"]
	n989 -> n1008 [label="1"]
	n989 -> n1224 [label="1"]
	n991 [label=<<i>991__ v(Vote)   save!</i>> color=blue]; 
	n1008 [label=<<i>1008__ Comment(Comment)   find</i>> color=blue]; 
	n1008 -> n1019 [label="2"]
	n1008 -> n1036 [label="5"]
	n1008 -> n1041 [label="5"]
	n1008 -> n1073 [label="7"]
	n1008 -> n1095 [label="8"]
	n1008 -> n1130 [label="9"]
	n1019 [label=<<i>1019__ User(User)   update_counters</i>> color=blue]; 
	n1036 [label=<<i>1036__ _self(Comment)   upvotes</i>> color=darkorange]; 
	n1036 -> n1073 [label="4"]
	n1036 -> n1095 [label="5"]
	n1036 -> n1130 [label="6"]
	n1041 [label=<<i>1041__ _self(Comment)   downvotes</i>> color=darkorange]; 
	n1041 -> n1073 [label="4"]
	n1041 -> n1095 [label="5"]
	n1041 -> n1130 [label="6"]
	n1073 [label=<<i>1073__ Comment connection   execute</i>> color=blue]; 
	n1095 [label=<<i>1095__ self tags(Tag)   select</i>> color=blue]; 
	n1130 [label=<<i>1130__ self comments(Comment)   where</i>> color=blue]; 
	n1130 -> n1131 [label="0"]
	n1131 [label=<<i>1131__ self comments where("user_id () ?", self user_id)   select</i>> color=blue]; 
	n1224 [label=<<i>1224__ Story(Story)   find</i>> color=blue]; 
	n1224 -> n1235 [label="2"]
	n1224 -> n1286 [label="6"]
	n1235 [label=<<i>1235__ User(User)   update_counters</i>> color=blue]; 
	n1286 [label=<<i>1286__ Story connection   execute</i>> color=blue]; 
	n1318 [label=<<i>1318__ Story(Story)   select</i>> color=blue]; 
	n1318 -> n1321 [label="0"]
	n1321 [label=<<i>1321__ Story select( id)   where</i>> color=blue]; 
	n1321 -> n1326 [label="2"]
	n1326 [label=<<i>1326__ Comment(Comment)   where</i>> color=blue]; 
	n1326 -> n1434 [label="2"]
	n1326 -> n1449 [label="2"]
	n1326 -> n1339 [label="3"]
	n1339 [label=<<i>1339__ self(Comment)   order</i>> color=blue]; 
	n1403 [label=<<i>1403__ node(Comment)   indent_level</i>> color=darkorange]; 
	n1434 [label=<<i>1434__ comments(Comment)   count</i>> color=blue]; 
	n1434 -> n1449 [label="0"]
	n1449 [label=<<i>1449__ self(Story)   comments_count</i>> color=darkorange]; 
	n1486 [label=<<i>1486__ self parent_comment   try</i>> color=blue]; 
	n1602 [label=<<i>1602__ self plaintext_comment scan(/\B\@((\w\-)+)/) flatten   uniq</i>> color=blue]; 
	n1602 -> n1613 [label="3"]
	n1613 [label=<<i>1613__ User(User)   where</i>> color=blue]; 
	n1613 -> n1614 [label="0"]
	n1614 [label=<<i>1614__ User where( username =) mention)   first</i>> color=blue]; 
	n1717 [label=<<i>1717__ self(Comment)   save</i>> color=blue]; 
	n1717 -> n1889 [label="6"]
	n1717 -> n2276 [label="6"]
	n1717 -> n2365 [label="6"]
	n1717 -> n2373 [label="6"]
	n1717 -> n2216 [label="7"]
	n1720 [label=<<i>1720__ Comment(Comment)   record_timestamps</i>> color=darkorange]; 
	n1889 [label=<<i>1889__ obj current_vote   try</i>> color=blue]; 
	n2216 [label=<<i>2216__ Vote(Vote)   where</i>> color=blue]; 
	n2276 [label=<<i>2276__ r_counts keys sort map{|k|      k == "" ? "+#{r_counts(k)}"   "#{r_counts(k)} #{VoteCOMMENT_REASONS(k)}"    }   join</i>> color=blue]; 
	n2365 [label=<<i>2365__ self moderation try( moderator)   try</i>> color=blue]; 
	n2365 -> n2366 [label="0"]
	n2366 [label=<<i>2366__ self moderation try( moderator)   try</i>> color=blue]; 
	n2373 [label=<<i>2373__ self moderation try( moderator)   try</i>> color=blue]; 
}