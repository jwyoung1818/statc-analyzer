digraph sketch {
	n20 [label=<<i>20__ User(User)   where</i>> color=blue]; 
	n20 -> n21 [label="0"]
	n21 [label=<<i>21__ User where( session_token =) session( u) to_s)   first</i>> color=blue]; 
	n109 [label=<<i>109__ self(ApplicationController)   params</i>> color=crimson]; 
	n142 [label=<<i>142__ self lock(true) where( key =) key)   first</i>> color=blue]; 
	n143 [label=<<i>143__ self lock(true)   where</i>> color=blue]; 
	n144 [label=<<i>144__ self(Keystore)   lock</i>> color=blue]; 
	n151 [label=<<i>151__ key   where</i>> color=blue]; 
	n153 [label=<<i>153__ kv(Keystore)   save!</i>> color=blue]; 
	n184 [label=<<i>184__ traffic_kv(Keystore)   value</i>> color=darkorange]; 
	n184 -> n186 [label="0"]
	n186 [label=<<i>186__ traffic_kv(Keystore)   save!</i>> color=blue]; 
	n188 [label=<<i>188__ date_kv(Keystore)   value</i>> color=darkorange]; 
	n188 -> n190 [label="0"]
	n190 [label=<<i>190__ date_kv(Keystore)   save!</i>> color=blue]; 
	n222 [label=<<i>222__ self(StoriesController)   params</i>> color=crimson]; 
	n222 -> n229 [label="2"]
	n225 [label=<<i>225__ self(StoriesController)   params</i>> color=crimson]; 
	n225 -> n229 [label="3"]
	n229 [label=<<i>229__ Story(Story)   where</i>> color=blue]; 
	n229 -> n230 [label="0"]
	n230 [label=<<i>230__ Story where( short_id =) params( story_id) || params( id))   first</i>> color=blue]; 
	n238 [label=<<i>238__ self(StoriesController)   params</i>> color=crimson]; 
	n238 -> n245 [label="2"]
	n241 [label=<<i>241__ self(StoriesController)   params</i>> color=crimson]; 
	n241 -> n245 [label="3"]
	n245 [label=<<i>245__ Story(Story)   where</i>> color=blue]; 
	n245 -> n246 [label="0"]
	n246 [label=<<i>246__ Story where( short_id =) params( story_id) || params( id))   first</i>> color=blue]; 
	n332 [label=<<i>332__ @story(Story)   is_expired</i>> color=darkorange]; 
	n336 [label=<<i>336__ @story(Story)   editor</i>> color=darkorange]; 
	n363 [label=<<i>363__ user_id   where</i>> color=blue]; 
	n421 [label=<<i>421__ self(Story)   short_id</i>> color=darkorange]; 
	n423 [label=<<i>423__ self(Story)   upvotes</i>> color=darkorange]; 
	n446 [label=<<i>446__ self tags(Tag)   select</i>> color=blue]; 
	n481 [label=<<i>481__ self comments(Comment)   where</i>> color=blue]; 
	n481 -> n482 [label="0"]
	n482 [label=<<i>482__ self comments where("user_id () ?", self user_id)   select</i>> color=blue]; 
	n482 -> n981 [label="17"]
	n566 [label=<<i>566__ self(Story)   hotness</i>> color=darkorange]; 
	n566 -> n981 [label="0"]
	n590 [label=<<i>590__ Keystore connection   execute</i>> color=blue]; 
	n594 [label=<<i>594__ Keystore connection   execute</i>> color=blue]; 
	n601 [label=<<i>601__ Keystore connection   execute</i>> color=blue]; 
	n611 [label=<<i>611__ kv   save!</i>> color=blue]; 
	n615 [label=<<i>615__ self where( key =) key) first   try</i>> color=blue]; 
	n616 [label=<<i>616__ self where( key =) key)   first</i>> color=blue]; 
	n617 [label=<<i>617__ self(Keystore)   where</i>> color=blue]; 
	n651 [label=<<i>651__ Vote(Vote)   where</i>> color=blue]; 
	n651 -> n652 [label="0"]
	n652 [label=<<i>652__ Vote where( user_id =) user_id,  story_id =) story_id,       comment_id =) comment_id)   first_or_initialize</i>> color=blue]; 
	n652 -> n697 [label="1"]
	n652 -> n703 [label="1"]
	n652 -> n745 [label="1"]
	n652 -> n762 [label="2"]
	n652 -> n905 [label="2"]
	n697 [label=<<i>697__ v(Vote)   destroy!</i>> color=blue]; 
	n703 [label=<<i>703__ v(Vote)   new_record?</i>> color=blue]; 
	n741 [label=<<i>741__ v(Vote)   vote</i>> color=darkorange]; 
	n741 -> n745 [label="0"]
	n741 -> n762 [label="1"]
	n741 -> n905 [label="1"]
	n743 [label=<<i>743__ v(Vote)   reason</i>> color=darkorange]; 
	n743 -> n745 [label="0"]
	n743 -> n762 [label="1"]
	n743 -> n905 [label="1"]
	n745 [label=<<i>745__ v(Vote)   save!</i>> color=blue]; 
	n762 [label=<<i>762__ Comment(Comment)   find</i>> color=blue]; 
	n762 -> n773 [label="2"]
	n762 -> n791 [label="5"]
	n762 -> n796 [label="5"]
	n762 -> n884 [label="7"]
	n773 [label=<<i>773__ User(User)   update_counters</i>> color=blue]; 
	n791 [label=<<i>791__ _self(Comment)   upvotes</i>> color=darkorange]; 
	n791 -> n884 [label="4"]
	n796 [label=<<i>796__ _self(Comment)   downvotes</i>> color=darkorange]; 
	n796 -> n884 [label="4"]
	n884 [label=<<i>884__ Comment connection   execute</i>> color=blue]; 
	n905 [label=<<i>905__ Story(Story)   find</i>> color=blue]; 
	n905 -> n916 [label="2"]
	n905 -> n967 [label="6"]
	n916 [label=<<i>916__ User(User)   update_counters</i>> color=blue]; 
	n967 [label=<<i>967__ Story connection   execute</i>> color=blue]; 
	n981 [label=<<i>981__ self(Story)   new_record?</i>> color=blue]; 
	n1015 [label=<<i>1015__ tg   new_record?</i>> color=blue]; 
	n1103 [label=<<i>1103__ self editor   try</i>> color=blue]; 
	n1103 -> n1104 [label="0"]
	n1104 [label=<<i>1104__ m(Moderation)   moderator_user_id</i>> color=darkorange]; 
	n1104 -> n1496 [label="0"]
	n1104 -> n1495 [label="3"]
	n1104 -> n1346 [label="4"]
	n1104 -> n1348 [label="4"]
	n1104 -> n1709 [label="6"]
	n1104 -> n1363 [label="9"]
	n1104 -> n1321 [label="11"]
	n1104 -> n1320 [label="11"]
	n1107 [label=<<i>1107__ m(Moderation)   story_id</i>> color=darkorange]; 
	n1107 -> n1496 [label="0"]
	n1107 -> n1495 [label="3"]
	n1107 -> n1346 [label="4"]
	n1107 -> n1348 [label="4"]
	n1107 -> n1709 [label="6"]
	n1107 -> n1363 [label="9"]
	n1107 -> n1321 [label="11"]
	n1107 -> n1320 [label="11"]
	n1117 [label=<<i>1117__ m(Moderation)   action</i>> color=darkorange]; 
	n1117 -> n1496 [label="0"]
	n1117 -> n1495 [label="3"]
	n1117 -> n1346 [label="4"]
	n1117 -> n1348 [label="4"]
	n1117 -> n1709 [label="6"]
	n1117 -> n1363 [label="9"]
	n1117 -> n1321 [label="11"]
	n1117 -> n1320 [label="11"]
	n1129 [label=<<i>1129__ m(Moderation)   action</i>> color=darkorange]; 
	n1129 -> n1496 [label="0"]
	n1129 -> n1495 [label="3"]
	n1129 -> n1346 [label="4"]
	n1129 -> n1348 [label="4"]
	n1129 -> n1709 [label="6"]
	n1129 -> n1363 [label="9"]
	n1129 -> n1321 [label="11"]
	n1129 -> n1320 [label="11"]
	n1180 [label=<<i>1180__ all_changes map{|k,v|        if k == "merged_story_id"          if v(1)            "merged into #{self merged_into_story short_id} " ((              "(#{self merged_into_story title})"          else            "unmerged from another story"          end        else          "changed #{k} from #{v(0) inspect} to #{v(1) inspect}"        end      }   join</i>> color=blue]; 
	n1180 -> n1181 [label="0"]
	n1181 [label=<<i>1181__ m(Moderation)   action</i>> color=darkorange]; 
	n1181 -> n1496 [label="0"]
	n1181 -> n1495 [label="3"]
	n1181 -> n1346 [label="4"]
	n1181 -> n1348 [label="4"]
	n1181 -> n1709 [label="6"]
	n1181 -> n1363 [label="9"]
	n1181 -> n1321 [label="11"]
	n1181 -> n1320 [label="11"]
	n1186 [label=<<i>1186__ m(Moderation)   reason</i>> color=darkorange]; 
	n1186 -> n1496 [label="0"]
	n1186 -> n1495 [label="3"]
	n1186 -> n1346 [label="4"]
	n1186 -> n1348 [label="4"]
	n1186 -> n1709 [label="6"]
	n1186 -> n1363 [label="9"]
	n1186 -> n1321 [label="11"]
	n1186 -> n1320 [label="11"]
	n1320 [label=<<i>1320__ self received_messages unread   count</i>> color=blue]; 
	n1320 -> n1321 [label="0"]
	n1321 [label=<<i>1321__ Keystore(Keystore)   put</i>> color=blue]; 
	n1346 [label=<<i>1346__ recipient   where</i>> color=blue]; 
	n1348 [label=<<i>1348__ recipient   where</i>> color=blue]; 
	n1363 [label=<<i>1363__ self(Message)   short_id</i>> color=darkorange]; 
	n1495 [label=<<i>1495__ m(Message)   save</i>> color=blue]; 
	n1496 [label=<<i>1496__ m(Moderation)   save</i>> color=blue]; 
	n1498 [label=<<i>1498__ self(Story)   is_moderated</i>> color=darkorange]; 
	n1498 -> n1709 [label="0"]
	n1534 [label=<<i>1534__ self title to_s split("") map{|chr|      if chr ord == 160        " "      else        chr      end    }   join</i>> color=blue]; 
	n1534 -> n1535 [label="0"]
	n1535 [label=<<i>1535__ self(Story)   title</i>> color=darkorange]; 
	n1535 -> n1709 [label="0"]
	n1569 [label=<<i>1569__ Story(Story)   select</i>> color=blue]; 
	n1569 -> n1572 [label="0"]
	n1572 [label=<<i>1572__ Story select( id)   where</i>> color=blue]; 
	n1572 -> n1577 [label="2"]
	n1577 [label=<<i>1577__ Comment(Comment)   where</i>> color=blue]; 
	n1577 -> n1685 [label="2"]
	n1577 -> n1700 [label="2"]
	n1577 -> n1590 [label="3"]
	n1590 [label=<<i>1590__ self(Comment)   order</i>> color=blue]; 
	n1654 [label=<<i>1654__ node(Comment)   indent_level</i>> color=darkorange]; 
	n1685 [label=<<i>1685__ comments(Comment)   count</i>> color=blue]; 
	n1685 -> n1700 [label="0"]
	n1700 [label=<<i>1700__ self(Story)   comments_count</i>> color=darkorange]; 
	n1709 [label=<<i>1709__ self(Story)   new_record?</i>> color=blue]; 
	n1741 [label=<<i>1741__ self(StoriesController)   params</i>> color=crimson]; 
	n1758 [label=<<i>1758__ @story(Story)   attributes</i>> color=darkorange]; 
	n1764 [label=<<i>1764__ @story(Story)   attributes</i>> color=darkorange]; 
	n1768 [label=<<i>1768__ @story(Story)   save</i>> color=blue]; 
}