 diff = Redmine::UnifiedDiff.new(
            diff, :type => diff_type,
            :max_lines => Setting.diff_max_lines_displayed.to_i,
            :style => diff_style) 
 diff.each do |table_file| 
 if diff.diff_type == 'sbs' 
 table_file.file_name 
 table_file.each_line do |spacing, line| 
 if spacing 
 end 
 line.nb_line_left 
 line.type_diff_left 
 line.html_line_left.html_safe 
 line.nb_line_right 
 line.type_diff_right 
 line.html_line_right.html_safe 
 end 
 else 
 table_file.file_name 
 table_file.each_line do |spacing, line| 
 if spacing 
 end 
 line.nb_line_left 
 line.nb_line_right 
 line.type_diff 
 line.html_line.html_safe 
 end 
 end 
 end 
 l(:text_diff_truncated) if diff.truncated? 
