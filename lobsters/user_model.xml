<model>
	<method name="update_unread_message_count">
		<query>
			<text>
			SELECT COUNT(*) FROM `messages`  WHERE `messages`.`recipient_user_id` = 1 AND `messages`.`has_been_read` = 0 AND `messages`.`deleted_by_recipient` = 0
			</text>
			<param>recipient_id</param>
			<table>messages</table>
			<operation>SELECT</operation>
			<return>message_count</return>
		</query>
		<query>
			<text>
			INSERT INTO keystores (`key`, `value`) VALUES ('user:1:unread_messages', 2) ON DUPLICATE KEY UPDATE `value` = 2
			</text>
			<param>message_count</param>
			<operation>INSERT</operation>
			<table>keystores</table>
		</query>
	</method>
</model>

