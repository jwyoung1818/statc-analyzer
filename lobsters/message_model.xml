<model>
	<method name="validates_presence_of_recipient" property="before_validation">
		<query>
			<text>
			SELECT  `users`.* FROM `users`  WHERE `users`.`id` = 1 LIMIT 1
			</text>
			<table>users</table>
			<operation>SELECT</operation>
			<field>ALL</field>
			<param>recipient_id</param>
			<return>TRUE</return>
		</query>
	</method>
	
	<method name="validates_presence_of_author" property="before_validation">
		<query>
			<text>
			SELECT  `users`.* FROM `users`  WHERE `users`.`id` = 1 LIMIT 1
			</text>
			<table>users</table>
			<operation>SELECT</operation>
			<field>ALL</field>
			<param>user.id</param>
			<return>TRUE</return>
		</query>
	</method>
	
	<method name="assign_short_id" property="before_validation">
		<action>
			<description>generate short_id, using hash function</description>
			<return>short_id</return>
		</action>
		<query>
			<text>
			SELECT  1 AS one FROM `messages`  WHERE `messages`.`short_id` = 'lkd8il' LIMIT 1
			</text>
			<param>short_id</param>
			<operation>SELECT</operation>
			<table>messages</table>
			<field>ALL</field>
			<return>short_id</return>
		</query>
	</method>
	
	<method name="update_unread_counts">
		<input>recipient_id</input>
		<call class="user" class_type="model" function_name="update_unread_message_count">
			<feed>recipient_id</feed>
		</call>
	</method>
	
	<method name="check_for_both_deleted">
		<input>recipient_id</input>
		<call class="user" class_type="model" function_name="">
			<feed>recipient_id</feed>
		</call>
	</method>

	<method name="save">
		<input>user.id</input>
		<input>body</input>
		<input>recipient_id</input>
		<input>short_id</input>
		<input>subject</input>
		<input>messages</input>
		<query>
			<text>
			INSERT INTO `messages` (`author_user_id`, `body`, `created_at`, `recipient_user_id`, `short_id`, `subject`) VALUES (1, 'please do!', '2015-10-01 19:43:18', 1, 'lkd8il', 'checking mysql trace')
			</text>
			<operation>INSERT</operation>
			<param>user.id</param>
			<param>body</param>
			<param>recipient_id</param>
			<param>short_id</param>
			<param>subject</param>
			<table>messages</table>
		</query>
	</method>	
</model>   	
           	
           	
           	
           	
           	
           	
           	
           	
           	
           	
           	
           	
           	
           	
           	
           	
